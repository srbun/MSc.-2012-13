/* prog38.c: This programme builds on 37 to append student info.[].

 * Last Modified: 17/12/2012
 ***/
/* motivation to enter student info as in a database
 * no alternative**/
/* outputs as expected:
*/

/* extra libraries included*/

#include <stdio.h>
#include <stdlib.h>
#include <string.h>

//prototype struct -info-group
struct student_info
 {
	char* names[100];
	int phone;
	int stuID;
};

//declare functions
void input_struct(struct student_info *s);
void read_file(struct student_info *s);
void write_file(struct student_info *s);

//--these tries did not work--
//void read_file_again(struct student_info *s);
//void write_file_again(struct student_info *s);

int main(void)
{
	char choice;
	struct student_info *student;
	student = (struct student_info*)malloc(sizeof(struct student_info));
	input_struct(student);
	
	//printf("names %s\n", student->names);
	//printf("phone %20d\n", student->phone);
	//printf("stuid %20d\n", student->stuID);
	
	fflush(stdin);
//request & input from user	
	printf("Enter 'r' to read a file and 'w' to write into a file.\n");
	scanf("%c", &choice);
	
	if(choice == 'r')
	{
		read_file(student);
//further choice to continue or quit	
	printf("\nWould you like to Read another file?\n");
	scanf("%c", &choice);
	
	if (choice == 'y')
		read_file(student);
	
	else
		return 1;
	}
	
	else if (choice == 'w')
	{	
		write_file(student);
	
	printf("\nWould you like to enter information for second student?\n");
	scanf("%c", &choice);
	
	if (choice == 'y')
	{
		input_struct(student);
		write_file(student);
	}
	else 
		return 1;
	}
free(student);
return 0;
}

void input_struct(struct student_info *s){
	printf("Enter your name:\n");
	scanf ("%s", &s->names);
	printf("Enter your phone #:\n");
	scanf ("%20d", &s->phone);
	printf("Enter your student ID:\n");
	scanf ("%20d", &s->stuID);
}

void read_file(struct student_info *s)
{
	FILE *fp;
	char filename[40];
	char read [100];
	
	printf("Enter filename to open for reading:\n");
	fgets(filename, 40, stdin);
	filename[strlen(filename)-1] = '\0';
	fp = fopen(filename, "r");
	
	while(fp == NULL)
	{
		fgets(filename, 40, stdin);
		filename[strlen(filename)-1] = '\0';
		fp = fopen(filename, "r");
	}
	while(!feof(fp))
	{
		fgets(read, 100, fp);
		printf("%s", read);
	}
}

void write_file(struct student_info *s)
{
	FILE *fp;
	char filename[40];
	
	printf("Enter filename to open a file for writing:\n");
	fgets(filename, 40, stdin);
	filename[strlen(filename)-1] = '\0';
	fp = fopen(filename, "w");

	while(fp == NULL)
	{
		fgets(filename, 40, stdin);
		filename[strlen(filename)-1] = '\0';
		fp = fopen(filename, "w");
	}

//	printf("value of struc is %s",s->names);
	fprintf(fp, "%s \n", s->names);
	fprintf(fp, "%d \n", s->phone);
	fprintf(fp, "%d \n", s->stuID);
}
